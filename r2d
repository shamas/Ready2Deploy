#!/usr/bin/env bash
source r2d.config

if [ ! -d $out ]
then
    echo "Making directory "$out
    mkdir $out
fi

function doreplacements {
    for f in `cat $inputfile`
    do
        if [ -f $f ]
        then
            echo "F: "$f
            bf=`basename $f`
            echo "R: "$bf
#sed "\_"$bf"_s_[\w\./]*"$bf"_"$bf"_" < $1
sed -n "\_[\w\./]*"$bf"_p" < $1
sed -n "\_[\w\./]*"$bf"_s_[\w\./]*"$bf"_5_p" < $1
#mv $out"tmp" $livef
        fi
    done
}

echo "Copying to "$out
for f in `cat $inputfile`
do
    bf=`basename $f`
    if [ -f $f ]
    then
    cp $f $out$bf
    else
        if [ ! -e $f ]
        then
            echo "Missing: "$f
        fi
    fi
done

echo Transforming...
for f in `ls $out`
do
    if [ -f $out$f ]
    then
	    echo "Processing "$f
        doreplacements $out$f
    fi
done

echo "FINISHED"

source $tforms
