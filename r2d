#!/usr/bin/env bash
source r2d.config

if [ ! -d $out ]
then
    echo "Making directory "$out
    mkdir $out
fi

function doreplacements {
    for f in `cat $inputfile`
    do
        if [ -f $f ]
        then
            echo "F: "$f
            bf=`basename $f`
            echo "R: "$bf
            count=`sed -n "\_[\w\./]*"$bf"_p" < $1 | wc -L`
            if [ $count -gt 0 ]
            then
                echo "Procesing for matches"
                sed -n "\_"$bf"_s_[a-z\.0-9A-Z\/]*"$bf"_"$bf"_p" < $1
            fi
            #mv $out"tmp" $livef
        fi
    done
}

echo "Copying to "$out
for f in `cat $inputfile`
do
    bf=`basename $f`
    if [ -f $f ]
    then
    cp $f $out$bf
    else
        if [ ! -e $f ]
        then
            echo "Missing: "$f
        fi
    fi
done

echo Transforming...
for f in `ls $out`
do
    if [ -f $out$f ]
    then
	    echo "Processing "$f
        doreplacements $out$f
    fi
done

echo "FINISHED"

source $tforms
